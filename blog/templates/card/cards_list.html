{% extends 'base.html' %}
{% load static %}
{% block title %} Lista de Cards {% endblock %}
{% block content %}

<script>
    // URLs dinâmicas para o JavaScript
    const URL_COMENTARIOS_LIST = "{% url 'comentarios-list' %}";
    const URL_NEW_COMENTARIO = "{% url 'new-comentario' %}";
    const CSRF_TOKEN = "{{ csrf_token }}";
</script>

<div class="mt-20 p-8 max-w-7xl mx-auto mb-12 pb-8 rounded-lg bg-[#121212]">
  <h1 class="text-2xl font-semibold text-gray-100 mb-6">Cards</h1>
  
  {% if cards %}
  <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
    {% for card in cards %}
    <article class="bg-[{{ card.cor_fundo }}]/20 border h-[440px] border-[{{ card.cor_destaque }}] rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition flex flex-col">
      {% if card.foto %}
      <img src="{{ card.foto.url }}" alt="{{ card.nome|default:'Card' }}" class="w-[90%] mx-auto h-[170px] rounded object-cover mt-4">
      {% else %}
      <div class="w-[90%] mx-auto mt-4 rounded h-[170px] bg-black/30 flex items-center justify-center text-gray-400">
        <span><i class="bi bi-person text-7xl text-[{{ card.cor_fundo }}]/50"></i></span>
      </div>
      {% endif %}
      
      <div class="p-4 flex flex-col flex-grow">
        <div class="flex-grow">
          <h2 class="font-semibold text-lg mb-1 truncate" style="color: {{ card.cor_destaque }};">{{ card.nome }}</h2>
          {% if card.insta %}
          <p class="text-sm mb-2" style="color: {{ card.cor_texto }}; opacity: 80%;">@{{ card.insta }}</p>
          {% endif %}
          

          <!-- Hobbies centralizados com cor de destaque -->
          <div class="flex flex-wrap items-center justify-center gap-2 my-4">
            {% for hobby in card.hobbies.all %}
            <span class="text-xs font-medium px-3 py-1 rounded-full" style="background-color: {{ card.cor_destaque }}; color: black">
              {{ hobby }}
            </span>
            {% empty %}
            <span class="text-xs font-medium px-3 py-1 rounded-full" style="background-color: {{ card.cor_destaque }}; color: black">
              Nenhum hobby
            </span>
            {% endfor %}
          </div>

          <p class="text-sm mb-3" style="color: {{ card.cor_texto }}; max-height:4.5rem; overflow:hidden;">{{ card.bio }}</p>
        </div>
        
        <!-- Seção fixa no rodapé do card -->
        <div class="flex items-center text-sm mt-auto pt-4 border-t border-gray-300/30">
          <button class="text-white bg-blue-600/80 px-2 py-1 rounded transition-300 hover:bg-blue-900 hover:shadow">
            Ver
          </button>

          <!-- botão comentários: agora com extra data attrs (insta e cor) -->
          <button 
            id="btn-comentarios{{ card.id }}" 
            data-card-id="{{ card.id }}"
            data-card-nome="{{ card.nome|escape }}"
            data-card-insta="{{ card.insta|default:'' }}"
            data-card-cor="{{ card.cor_destaque }}"
            class="btn-comentarios text-white ml-2 bg-gray-600 px-2 py-1 rounded transition-300 hover:bg-gray-700 hover:shadow"
          >
            Comentários
          </button>

          <!-- Curtidas: transformar em botão com data-card-id para AJAX -->
          <button class="btn-curtir like-btn ml-auto" data-card-id="{{ card.id }}" aria-label="Curtir" aria-pressed="false">

            <i class="bi bi-heart heart-outline" aria-hidden="true"></i>
            <i class="bi bi-heart-fill heart-fill" aria-hidden="true"></i>

            <span class="curtidas-count">{{ card.curtidas|default:0 }}</span>
          </button>

        </div>
      </article>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-gray-400">Nenhum card criado ainda.</p>
  {% endif %}
</div>


<!-- Painel de Comentários - Responsivo -->
<div
  class="fixed bottom-0 left-0 md:right-0 md:left-auto w-full md:w-[400px] h-[65%] md:h-screen bg-gradient-to-b from-black/80 via-black/70 to-black/60 p-5 md:p-6 rounded-t-[12px] md:rounded-l-[12px] shadow-2xl transform translate-y-full md:translate-y-0 md:translate-x-full transition-transform duration-500 ease-in-out flex flex-col z-[2000] coments"
>
  <!-- Cabeçalho -->
  <div class="mb-4 text-center md:text-left">
    <h2 id="titulo-comentarios" class="text-white text-xl font-semibold">
      Comentários de <span id="nome-card-comentarios">Nenhum card selecionado</span>
    </h2>

    <p id="insta-card-comentarios" class="text-gray-400 text-sm mt-2 flex items-center justify-center md:justify-start gap-2">
      <i class="bi bi-at text-xs text-gray-500"></i>
      <span class="text-gray-300"></span>
    </p>

    <!-- hidden input mantido -->
    <input type="hidden" id="card-id-atual" value="">
  </div>

  <!-- Lista de comentários -->
  <div class="flex-1 overflow-y-auto mb-3 space-y-4 comentarios-lista text-sm md:text-base">
    <!-- Placeholder quando vazio -->
    <div class="comentarios-empty text-center text-gray-400 py-8 hidden">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-3 h-8 w-8 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v6a2 2 0 01-2 2h-3l-4 4z"/>
      </svg>
      <div class="text-sm">Nenhum comentário ainda — seja o primeiro a comentar!</div>
    </div>
    <!-- Comentários serão inseridos aqui pelo JS -->
  </div>

  <!-- Formulário (Nome + Comentário + botão) -->
  <div class="mt-auto w-full">
    <!-- Nome -->
    <label class="sr-only" for="nome-exibicao">Nome de Exibição</label>
    <div class="w-full mb-3 flex items-center gap-3">
      <!-- avatar gerado pelo nome (simples circle) -->
      <div class="hidden md:flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-br from-slate-700 to-slate-900 text-white">
        <i class="bi bi-person-fill"></i>
      </div>

      <input
        id="nome-exibicao"
        type="text"
        placeholder="Nome de Exibição"
        class="nome_exibicao flex-1 bg-slate-800/70 placeholder:text-slate-400 text-white h-11 rounded-lg px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-40 transition"
      />
    </div>

    <!-- Comentário -->
    <label class="sr-only" for="comentario-input">Comentário</label>
    <textarea
      id="comentario-input"
      placeholder="Escreva seu comentário..."
      class="comentario w-full resize-none h-24 md:h-28 bg-slate-900/70 placeholder:text-slate-400 text-slate-100 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-30 transition mb-3"
    ></textarea>

    <!-- Barra de ações (botão publicar + contadores/aviso) -->
    <div class="flex items-center justify-between gap-3">
      <button
        class="w-full publicar inline-flex items-center gap-3 rounded-lg bg-blue-500 hover:bg-blue-600 active:scale-95 text-white font-semibold px-4 py-2 transition-shadow shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400"
        title="Publicar Comentário"
      >
        <i class="bi bi-send-fill rotate-45 text-sm"></i>
        <span>Publicar Comentário</span>
      </button>
    </div>
  </div>
</div>

<script src="{% static 'javascript/comentarios.js' %}"></script>
{% endblock %}